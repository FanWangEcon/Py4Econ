<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Docker Container | Data Structures and Cloud Services with Python</title>
  <meta name="description" content="Numpy documentation examples." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Docker Container | Data Structures and Cloud Services with Python" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Numpy documentation examples." />
  <meta name="github-repo" content="fanwangecon/R4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Docker Container | Data Structures and Cloud Services with Python" />
  
  <meta name="twitter:description" content="Numpy documentation examples." />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2020-12-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="amazon-web-services.html"/>
<link rel="next" href="get-data.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-11"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-11');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Cloud Services with Python</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>1</b> Data Structures</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data-structures.html"><a href="data-structures.html#numbers-strings-lists-and-tuples"><i class="fa fa-check"></i><b>1.1</b> Numbers, Strings, Lists and Tuples</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="data-structures.html"><a href="data-structures.html#numeric-basics"><i class="fa fa-check"></i><b>1.1.1</b> Numeric Basics</a></li>
<li class="chapter" data-level="1.1.2" data-path="data-structures.html"><a href="data-structures.html#tuple"><i class="fa fa-check"></i><b>1.1.2</b> Tuple</a></li>
<li class="chapter" data-level="1.1.3" data-path="data-structures.html"><a href="data-structures.html#list"><i class="fa fa-check"></i><b>1.1.3</b> List</a></li>
<li class="chapter" data-level="1.1.4" data-path="data-structures.html"><a href="data-structures.html#strings"><i class="fa fa-check"></i><b>1.1.4</b> Strings</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-structures.html"><a href="data-structures.html#dictionary"><i class="fa fa-check"></i><b>1.2</b> Dictionary</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="data-structures.html"><a href="data-structures.html#dictionary-1"><i class="fa fa-check"></i><b>1.2.1</b> Dictionary</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="data-structures.html"><a href="data-structures.html#numpy-arrays"><i class="fa fa-check"></i><b>1.3</b> Numpy Arrays</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="data-structures.html"><a href="data-structures.html#generate-matrix-from-arrays"><i class="fa fa-check"></i><b>1.3.1</b> Generate Matrix from Arrays</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="pandas.html"><a href="pandas.html"><i class="fa fa-check"></i><b>2</b> Pandas</a>
<ul>
<li class="chapter" data-level="2.1" data-path="pandas.html"><a href="pandas.html#panda-basics"><i class="fa fa-check"></i><b>2.1</b> Panda Basics</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="pandas.html"><a href="pandas.html#generate-matrix-from-arrays-1"><i class="fa fa-check"></i><b>2.1.1</b> Generate Matrix from Arrays</a></li>
<li class="chapter" data-level="2.1.2" data-path="pandas.html"><a href="pandas.html#select-rows-and-columns-from-dataframe"><i class="fa fa-check"></i><b>2.1.2</b> Select Rows and Columns from Dataframe</a></li>
<li class="chapter" data-level="2.1.3" data-path="pandas.html"><a href="pandas.html#pandas-importing-and-exporting"><i class="fa fa-check"></i><b>2.1.3</b> Pandas Importing and Exporting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#function-arguments-and-returns"><i class="fa fa-check"></i><b>3.1</b> Function Arguments and Returns</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="functions.html"><a href="functions.html#data-types"><i class="fa fa-check"></i><b>3.1.1</b> Data Types</a></li>
<li class="chapter" data-level="3.1.2" data-path="functions.html"><a href="functions.html#function-arguments"><i class="fa fa-check"></i><b>3.1.2</b> Function Arguments</a></li>
<li class="chapter" data-level="3.1.3" data-path="functions.html"><a href="functions.html#python-command-line-arguments-parsing"><i class="fa fa-check"></i><b>3.1.3</b> Python Command-line Arguments Parsing</a></li>
<li class="chapter" data-level="3.1.4" data-path="functions.html"><a href="functions.html#function-returns"><i class="fa fa-check"></i><b>3.1.4</b> Function Returns</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#exceptions"><i class="fa fa-check"></i><b>3.2</b> Exceptions</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#exception-handling"><i class="fa fa-check"></i><b>3.2.1</b> Exception Handling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>4</b> Statistics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="statistics.html"><a href="statistics.html#markov-process"><i class="fa fa-check"></i><b>4.1</b> Markov Process</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="statistics.html"><a href="statistics.html#close-value-comparison"><i class="fa fa-check"></i><b>4.1.1</b> Close Value Comparison</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html"><i class="fa fa-check"></i><b>5</b> Tables and Graphs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#matplotlib-base-plots"><i class="fa fa-check"></i><b>5.1</b> Matplotlib Base Plots</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#line-and-scatter-plots"><i class="fa fa-check"></i><b>5.1.1</b> Line and Scatter Plots</a></li>
<li class="chapter" data-level="5.1.2" data-path="tables-and-graphs.html"><a href="tables-and-graphs.html#text-plot"><i class="fa fa-check"></i><b>5.1.2</b> Text Plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="amazon-web-services.html"><a href="amazon-web-services.html"><i class="fa fa-check"></i><b>6</b> Amazon Web Services</a>
<ul>
<li class="chapter" data-level="6.1" data-path="amazon-web-services.html"><a href="amazon-web-services.html#aws-setup"><i class="fa fa-check"></i><b>6.1</b> AWS Setup</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="amazon-web-services.html"><a href="amazon-web-services.html#aws-setup-1"><i class="fa fa-check"></i><b>6.1.1</b> AWS Setup</a></li>
<li class="chapter" data-level="6.1.2" data-path="amazon-web-services.html"><a href="amazon-web-services.html#aws-boto3"><i class="fa fa-check"></i><b>6.1.2</b> AWS Boto3</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="amazon-web-services.html"><a href="amazon-web-services.html#s3"><i class="fa fa-check"></i><b>6.2</b> S3</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="amazon-web-services.html"><a href="amazon-web-services.html#s3-usages"><i class="fa fa-check"></i><b>6.2.1</b> S3 Usages</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="amazon-web-services.html"><a href="amazon-web-services.html#batch"><i class="fa fa-check"></i><b>6.3</b> Batch</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="amazon-web-services.html"><a href="amazon-web-services.html#aws-batch-run"><i class="fa fa-check"></i><b>6.3.1</b> AWS Batch Run</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="docker-container.html"><a href="docker-container.html"><i class="fa fa-check"></i><b>7</b> Docker Container</a>
<ul>
<li class="chapter" data-level="7.1" data-path="docker-container.html"><a href="docker-container.html#docker-setup"><i class="fa fa-check"></i><b>7.1</b> Docker Setup</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="docker-container.html"><a href="docker-container.html#docker-setup-1"><i class="fa fa-check"></i><b>7.1.1</b> Docker Setup</a></li>
<li class="chapter" data-level="7.1.2" data-path="docker-container.html"><a href="docker-container.html#ecr-setup"><i class="fa fa-check"></i><b>7.1.2</b> ECR Setup</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>8</b> Get Data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="get-data.html"><a href="get-data.html#environmental-data"><i class="fa fa-check"></i><b>8.1</b> Environmental Data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="get-data.html"><a href="get-data.html#ecmwf-era5-data"><i class="fa fa-check"></i><b>8.1.1</b> ECMWF ERA5 Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="system-and-support.html"><a href="system-and-support.html"><i class="fa fa-check"></i><b>9</b> System and Support</a>
<ul>
<li class="chapter" data-level="9.1" data-path="system-and-support.html"><a href="system-and-support.html#command-line"><i class="fa fa-check"></i><b>9.1</b> Command Line</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="system-and-support.html"><a href="system-and-support.html#python-command-line"><i class="fa fa-check"></i><b>9.1.1</b> Python Command Line</a></li>
<li class="chapter" data-level="9.1.2" data-path="system-and-support.html"><a href="system-and-support.html#run-matlab-functions"><i class="fa fa-check"></i><b>9.1.2</b> Run Matlab Functions</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="system-and-support.html"><a href="system-and-support.html#file-in-and-out"><i class="fa fa-check"></i><b>9.2</b> File In and Out</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="system-and-support.html"><a href="system-and-support.html#check-read-write-and-convert-files"><i class="fa fa-check"></i><b>9.2.1</b> Check, Read, Write and Convert Files</a></li>
<li class="chapter" data-level="9.2.2" data-path="system-and-support.html"><a href="system-and-support.html#folder-operations"><i class="fa fa-check"></i><b>9.2.2</b> Folder Operations</a></li>
<li class="chapter" data-level="9.2.3" data-path="system-and-support.html"><a href="system-and-support.html#parse-yaml"><i class="fa fa-check"></i><b>9.2.3</b> Parse Yaml</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="system-and-support.html"><a href="system-and-support.html#install-python"><i class="fa fa-check"></i><b>9.3</b> Install Python</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="system-and-support.html"><a href="system-and-support.html#core-installations"><i class="fa fa-check"></i><b>9.3.1</b> Core Installations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="system-and-support.html"><a href="system-and-support.html#documentation"><i class="fa fa-check"></i><b>9.4</b> Documentation</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="system-and-support.html"><a href="system-and-support.html#numpy-doc-documentation-guide"><i class="fa fa-check"></i><b>9.4.1</b> Numpy Doc Documentation Guide</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#data-structures-links"><i class="fa fa-check"></i><b>A.1</b> Data Structures links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-numbers-strings-lists-and-tuplesnumbers-strings-lists-and-tuples-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 Numbers, Strings, Lists and Tuples</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-dictionarydictionary-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 Dictionary</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-numpy-arraysnumpy-arrays-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Numpy Arrays</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#pandas-links"><i class="fa fa-check"></i><b>A.2</b> Pandas links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-panda-basicspanda-basics-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 Panda Basics</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.3</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-function-arguments-and-returnsfunction-arguments-and-returns-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Function Arguments and Returns</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-exceptionsexceptions-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Exceptions</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#statistics-links"><i class="fa fa-check"></i><b>A.4</b> Statistics links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-markov-processmarkov-process-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Markov Process</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-and-graphs-links"><i class="fa fa-check"></i><b>A.5</b> Tables and Graphs links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-matplotlib-base-plotsmatplotlib-base-plots-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 Matplotlib Base Plots</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#amazon-web-services-links"><i class="fa fa-check"></i><b>A.6</b> Amazon Web Services links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-aws-setupaws-setup-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 AWS Setup</span> links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-s3s3-links"><i class="fa fa-check"></i><b>A.6.2</b> <span>Section 6.2 S3</span> links</a></li>
<li class="chapter" data-level="A.6.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.3-batchbatch-links"><i class="fa fa-check"></i><b>A.6.3</b> <span>Section 6.3 Batch</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#docker-container-links"><i class="fa fa-check"></i><b>A.7</b> Docker Container links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-docker-setupdocker-setup-links"><i class="fa fa-check"></i><b>A.7.1</b> <span>Section 7.1 Docker Setup</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#get-data-links"><i class="fa fa-check"></i><b>A.8</b> Get Data links</a>
<ul>
<li class="chapter" data-level="A.8.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-8.1-environmental-dataenvironmental-data-links"><i class="fa fa-check"></i><b>A.8.1</b> <span>Section 8.1 Environmental Data</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#system-and-support-links"><i class="fa fa-check"></i><b>A.9</b> System and Support links</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.1-command-linecommand-line-links"><i class="fa fa-check"></i><b>A.9.1</b> <span>Section 9.1 Command Line</span> links</a></li>
<li class="chapter" data-level="A.9.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.2-file-in-and-outfile-in-and-out-links"><i class="fa fa-check"></i><b>A.9.2</b> <span>Section 9.2 File In and Out</span> links</a></li>
<li class="chapter" data-level="A.9.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.3-install-pythoninstall-python-links"><i class="fa fa-check"></i><b>A.9.3</b> <span>Section 9.3 Install Python</span> links</a></li>
<li class="chapter" data-level="A.9.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-9.4-documentationdocumentation-links"><i class="fa fa-check"></i><b>A.9.4</b> <span>Section 9.4 Documentation</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/Py4Econ/bookdown/index.html" target="blank">Py4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures and Cloud Services with Python</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="docker-container" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Docker Container</h1>

<div id="docker-setup" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Docker Setup</h2>

<div id="docker-setup-1" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Docker Setup</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/Py4Econ/">Python Code Examples</a> Repository (<a href="https://fanwangecon.github.io/Py4Econ/bookdown">bookdown site</a>) or the <a href="https://pyfan.readthedocs.io/en/latest/">pyfan</a> Package (<a href="https://pyfan.readthedocs.io/en/latest/reference.html">API</a>).</p>
</blockquote>
<div id="install-docker-on-aws" class="section level4" number="7.1.1.1">
<h4><span class="header-section-number">7.1.1.1</span> Install Docker on AWS</h4>
<p><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/docker-basics.html">Installation Instructions</a></p>
<ol style="list-style-type: decimal">
<li>Putty</li>
<li>access to .pem key</li>
<li>conda aws environment below</li>
</ol>
<p>For Amazon Linux 2:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb343-1"><a href="docker-container.html#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SSH into EC2 Instance</span></span>
<span id="cb343-2"><a href="docker-container.html#cb343-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> ec2-user@ec2-52-23-218-117.compute-1.amazonaws.com</span>
<span id="cb343-3"><a href="docker-container.html#cb343-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Update</span></span>
<span id="cb343-4"><a href="docker-container.html#cb343-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> yum update -y</span>
<span id="cb343-5"><a href="docker-container.html#cb343-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install</span></span>
<span id="cb343-6"><a href="docker-container.html#cb343-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> amazon-linux-extras install docker -y</span>
<span id="cb343-7"><a href="docker-container.html#cb343-7" aria-hidden="true" tabindex="-1"></a><span class="co"># start service</span></span>
<span id="cb343-8"><a href="docker-container.html#cb343-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service docker start</span>
<span id="cb343-9"><a href="docker-container.html#cb343-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service docker status</span>
<span id="cb343-10"><a href="docker-container.html#cb343-10" aria-hidden="true" tabindex="-1"></a><span class="co"># execute docker commands without sudo</span></span>
<span id="cb343-11"><a href="docker-container.html#cb343-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> usermod -a -G docker ec2-user</span>
<span id="cb343-12"><a href="docker-container.html#cb343-12" aria-hidden="true" tabindex="-1"></a><span class="co"># log out and in reboot does not change public address</span></span>
<span id="cb343-13"><a href="docker-container.html#cb343-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> reboot</span>
<span id="cb343-14"><a href="docker-container.html#cb343-14" aria-hidden="true" tabindex="-1"></a><span class="co"># if docker info does not work, docker start again</span></span>
<span id="cb343-15"><a href="docker-container.html#cb343-15" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> info</span></code></pre></div>
</div>
<div id="create-a-dockerfile-and-build-it" class="section level4" number="7.1.1.2">
<h4><span class="header-section-number">7.1.1.2</span> Create a Dockerfile and build it</h4>
<p>Create a Dockerfile and build it. Building a dockerfile generates a docker image:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb344-1"><a href="docker-container.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># docker folder</span></span>
<span id="cb344-2"><a href="docker-container.html#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/docker</span>
<span id="cb344-3"><a href="docker-container.html#cb344-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cd into docker folder</span></span>
<span id="cb344-4"><a href="docker-container.html#cb344-4" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/docker</span>
<span id="cb344-5"><a href="docker-container.html#cb344-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create a Dockerfile in the docker folder</span></span>
<span id="cb344-6"><a href="docker-container.html#cb344-6" aria-hidden="true" tabindex="-1"></a><span class="co"># copy the Example Dockerfile below to the Dockerfile</span></span>
<span id="cb344-7"><a href="docker-container.html#cb344-7" aria-hidden="true" tabindex="-1"></a><span class="ex">vim</span> Dockerfile</span>
<span id="cb344-8"><a href="docker-container.html#cb344-8" aria-hidden="true" tabindex="-1"></a><span class="co"># in the docker directory build the docker file</span></span>
<span id="cb344-9"><a href="docker-container.html#cb344-9" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build -t hello-world .</span></code></pre></div>
<p>Example Dockerfile:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb345-1"><a href="docker-container.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> ubuntu:12.04</span>
<span id="cb345-2"><a href="docker-container.html#cb345-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-3"><a href="docker-container.html#cb345-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Install dependencies</span></span>
<span id="cb345-4"><a href="docker-container.html#cb345-4" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get update -y</span>
<span id="cb345-5"><a href="docker-container.html#cb345-5" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get install -y apache2</span>
<span id="cb345-6"><a href="docker-container.html#cb345-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-7"><a href="docker-container.html#cb345-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Install apache and write hello world message</span></span>
<span id="cb345-8"><a href="docker-container.html#cb345-8" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> echo <span class="st">&quot;Hello World!&quot;</span> <span class="op">&gt;</span> /var/www/index.html</span>
<span id="cb345-9"><a href="docker-container.html#cb345-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-10"><a href="docker-container.html#cb345-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure apache</span></span>
<span id="cb345-11"><a href="docker-container.html#cb345-11" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> a2enmod rewrite</span>
<span id="cb345-12"><a href="docker-container.html#cb345-12" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> chown -R www-data:www-data /var/www</span>
<span id="cb345-13"><a href="docker-container.html#cb345-13" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> APACHE_RUN_USER www-data</span>
<span id="cb345-14"><a href="docker-container.html#cb345-14" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> APACHE_RUN_GROUP www-data</span>
<span id="cb345-15"><a href="docker-container.html#cb345-15" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> APACHE_LOG_DIR /var/log/apache2</span>
<span id="cb345-16"><a href="docker-container.html#cb345-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-17"><a href="docker-container.html#cb345-17" aria-hidden="true" tabindex="-1"></a><span class="ex">EXPOSE</span> 80</span>
<span id="cb345-18"><a href="docker-container.html#cb345-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-19"><a href="docker-container.html#cb345-19" aria-hidden="true" tabindex="-1"></a><span class="ex">CMD</span> [<span class="st">&quot;/usr/sbin/apache2&quot;</span>, <span class="st">&quot;-D&quot;</span>,  <span class="st">&quot;FOREGROUND&quot;</span>]</span></code></pre></div>
</div>
<div id="run-enter-and-exit" class="section level4" number="7.1.1.3">
<h4><span class="header-section-number">7.1.1.3</span> Run, Enter and Exit</h4>
<p><em>docker build</em> generates a docker image, we start the docker container, run using the image created.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb346-1"><a href="docker-container.html#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list docker images available to run</span></span>
<span id="cb346-2"><a href="docker-container.html#cb346-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> images</span></code></pre></div>
<div class="sourceCode" id="cb347"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb347-1"><a href="docker-container.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="ex">These</span> could be some images that are shown after running *docker images*:</span>
<span id="cb347-2"><a href="docker-container.html#cb347-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-3"><a href="docker-container.html#cb347-3" aria-hidden="true" tabindex="-1"></a><span class="ex">REPOSITORY</span>                                                     TAG                 IMAGE ID            CREATED             SIZE</span>
<span id="cb347-4"><a href="docker-container.html#cb347-4" aria-hidden="true" tabindex="-1"></a><span class="ex">XXXX7367XXXX.dkr.ecr.us-east-1.amazonaws.com/fanconda</span>       latest              5d1a0df0796e        8 days ago          3.52GB</span>
<span id="cb347-5"><a href="docker-container.html#cb347-5" aria-hidden="true" tabindex="-1"></a><span class="ex">XXXX7367XXXX.dkr.ecr.us-east-1.amazonaws.com/fanconda2020</span>   latest              2db5e859d70c        2 weeks ago         3.4GB</span>
<span id="cb347-6"><a href="docker-container.html#cb347-6" aria-hidden="true" tabindex="-1"></a><span class="ex">fanconda2020</span>                                                latest              2db5e859d70c        2 weeks ago         3.4GB</span>
<span id="cb347-7"><a href="docker-container.html#cb347-7" aria-hidden="true" tabindex="-1"></a><span class="ex">fanconda5</span>                                                   latest              fa55672e7753        2 weeks ago         3.4GB</span>
<span id="cb347-8"><a href="docker-container.html#cb347-8" aria-hidden="true" tabindex="-1"></a><span class="ex">fanconda3</span>                                                   latest              2083f1124465        2 weeks ago         2.91GB</span></code></pre></div>
<p>Run the image and enter into it (use an image name) and run commands with programs, upon exit, container is stopped. Entering back into the container, the data was generated before now is no longer there, it is a new container based on the same image.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb348-1"><a href="docker-container.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="co"># will be inside now the conda image (base)</span></span>
<span id="cb348-2"><a href="docker-container.html#cb348-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run -t -i fanconda /bin/bash</span>
<span id="cb348-3"><a href="docker-container.html#cb348-3" aria-hidden="true" tabindex="-1"></a><span class="co"># can run programs inside here that have been loaded into the image</span></span>
<span id="cb348-4"><a href="docker-container.html#cb348-4" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> /fanProg/invoke/run.py -A ng_s_t=kap_m0_nld_m_simu=2=3 -B b -C 20180814_beta -D esti_param.beta -E None -F min_graphs -G simu --no-ge --no-multiprocess --no-esti</span>
<span id="cb348-5"><a href="docker-container.html#cb348-5" aria-hidden="true" tabindex="-1"></a><span class="co"># review generated outputs inside docker, results are stored by the run.py program and associated file, to a data folder</span></span>
<span id="cb348-6"><a href="docker-container.html#cb348-6" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /data</span>
<span id="cb348-7"><a href="docker-container.html#cb348-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
<span id="cb348-8"><a href="docker-container.html#cb348-8" aria-hidden="true" tabindex="-1"></a><span class="co"># To exit the currently running docker</span></span>
<span id="cb348-9"><a href="docker-container.html#cb348-9" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span></span>
<span id="cb348-10"><a href="docker-container.html#cb348-10" aria-hidden="true" tabindex="-1"></a><span class="co"># show docker container exited</span></span>
<span id="cb348-11"><a href="docker-container.html#cb348-11" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps -a</span></code></pre></div>
<p>Root directory in conda docker:
&gt; fanProg bin boot data dev etc home lib lib64 media mnt opt proc pyfan root run sbin srv sys tmp usr var</p>
<p>Run the image with program without entering into it.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb349-1"><a href="docker-container.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run fancondajmp python /ThaiJMP/invoke/run.py -A ng_s_t=kap_m0_nld_m_simu=2=3 -B b -C 20180814_beta -D esti_param.beta -E None -F min_graphs -G simu --no-ge --no-multiprocess --no-esti</span></code></pre></div>
<ul>
<li><a href="https://stackoverflow.com/questions/30209776/docker-container-will-automatically-stop-after-docker-run-d">Docker container will automatically stop after “docker run -d”</a></li>
</ul>
</div>
<div id="status-and-cleaning" class="section level4" number="7.1.1.4">
<h4><span class="header-section-number">7.1.1.4</span> Status and Cleaning</h4>
<div id="docker-file-and-git-repo" class="section level5" number="7.1.1.4.1">
<h5><span class="header-section-number">7.1.1.4.1</span> Docker file and Git Repo</h5>
<p>To have docker file access a git repo without exposing git repo password. Generate a private token, and access as below. See <a href="https://stackoverflow.com/a/29464430/8280804">stackoverflow-23391839</a>.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb350-1"><a href="docker-container.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> git clone https://b123451234dfc025a836927PRIVATETOKEND1239@github.com/FanWangEcon/ThaiJMP.git /ThaiJMP/</span></code></pre></div>
</div>
<div id="docker-status-space-and-clean" class="section level5" number="7.1.1.4.2">
<h5><span class="header-section-number">7.1.1.4.2</span> Docker Status, Space and Clean</h5>
<p>First, start service:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb351-1"><a href="docker-container.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start docker</span></span>
<span id="cb351-2"><a href="docker-container.html#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service docker start</span>
<span id="cb351-3"><a href="docker-container.html#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="co"># see status</span></span>
<span id="cb351-4"><a href="docker-container.html#cb351-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service docker status</span></code></pre></div>
<p>Second, list all docker related space usages, containers and images:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb352-1"><a href="docker-container.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check disk usage</span></span>
<span id="cb352-2"><a href="docker-container.html#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> system df</span></code></pre></div>
<p>Third, clean containers</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb353-1"><a href="docker-container.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># see docker containers</span></span>
<span id="cb353-2"><a href="docker-container.html#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> container ls -a</span>
<span id="cb353-3"><a href="docker-container.html#cb353-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove all stopped docker containers</span></span>
<span id="cb353-4"><a href="docker-container.html#cb353-4" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> rm <span class="va">$(</span><span class="ex">docker</span> ps -a -q<span class="va">)</span></span></code></pre></div>
<p>Fourth, clean images</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb354-1"><a href="docker-container.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list all images</span></span>
<span id="cb354-2"><a href="docker-container.html#cb354-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> images</span>
<span id="cb354-3"><a href="docker-container.html#cb354-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> images --all</span>
<span id="cb354-4"><a href="docker-container.html#cb354-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean all images not referenced by a container</span></span>
<span id="cb354-5"><a href="docker-container.html#cb354-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> image prune</span></code></pre></div>

</div>
</div>
</div>
<div id="ecr-setup" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> ECR Setup</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/Py4Econ/">Python Code Examples</a> Repository (<a href="https://fanwangecon.github.io/Py4Econ/bookdown">bookdown site</a>) or the <a href="https://pyfan.readthedocs.io/en/latest/">pyfan</a> Package (<a href="https://pyfan.readthedocs.io/en/latest/reference.html">API</a>).</p>
</blockquote>
<div id="pull-from-elastic-container-registry-ecr" class="section level4" number="7.1.2.1">
<h4><span class="header-section-number">7.1.2.1</span> Pull from Elastic Container Registry (ECR)</h4>
<p>Given docker files already on ECR, in EC2, first, get password, then pull.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb355-1"><a href="docker-container.html#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log in</span></span>
<span id="cb355-2"><a href="docker-container.html#cb355-2" aria-hidden="true" tabindex="-1"></a><span class="co"># copy the output from the line below and paste</span></span>
<span id="cb355-3"><a href="docker-container.html#cb355-3" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ecr get-login --no-include-email</span>
<span id="cb355-4"><a href="docker-container.html#cb355-4" aria-hidden="true" tabindex="-1"></a><span class="co"># this is copied from output of the command above</span></span>
<span id="cb355-5"><a href="docker-container.html#cb355-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> login -u AWS -p PASSWORDPASSWORDPASSWORDPASSWORD https://XXXX7367XXXX.dkr.ecr.us-east-1.amazonaws.com</span>
<span id="cb355-6"><a href="docker-container.html#cb355-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pull from docker</span></span>
<span id="cb355-7"><a href="docker-container.html#cb355-7" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull XXXX7367XXXX.dkr.ecr.us-east-1.amazonaws.com/fancondaXX</span></code></pre></div>
</div>
<div id="update-elastic-container-registry-ecr" class="section level4" number="7.1.2.2">
<h4><span class="header-section-number">7.1.2.2</span> Update Elastic Container Registry (ECR)</h4>
<p>There is a local conda file, perhaps some project repo have been updated, need to update docker file on ECR (or create new ones). Controlling EC2 can be done manually, or via <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/prereqs-ssm-agent.html">SSM</a>.</p>
<ol style="list-style-type: decimal">
<li>Start a EC2 Instance</li>
<li>Create a docker folder on EC2 instance (on remote)</li>
<li>scp update dockerfile in EC2 docker folder (local to remote)</li>
<li>build on remote server docker container (on remote)</li>
<li>push from EC2 updated docker to ECR (on remote)</li>
</ol>
<p>First, after creating/starting a EC2 instance, create a docker file and scp update:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb356-1"><a href="docker-container.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Then a sequences of SSM calls:</span></span>
<span id="cb356-2"><a href="docker-container.html#cb356-2" aria-hidden="true" tabindex="-1"></a><span class="co"># on local machine:</span></span>
<span id="cb356-3"><a href="docker-container.html#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> -i <span class="st">&quot;C:/Users/fan/CondaPrj/boto3aws/aws_ec2/pem/fan_wang-key-pair-us_east_nv.pem&quot;</span> ec2-user@54.161.29.209</span>
<span id="cb356-4"><a href="docker-container.html#cb356-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-5"><a href="docker-container.html#cb356-5" aria-hidden="true" tabindex="-1"></a><span class="co"># if new instance, create a docker folder under main</span></span>
<span id="cb356-6"><a href="docker-container.html#cb356-6" aria-hidden="true" tabindex="-1"></a><span class="co"># on remote machine</span></span>
<span id="cb356-7"><a href="docker-container.html#cb356-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> /home/ec2-user/docker</span>
<span id="cb356-8"><a href="docker-container.html#cb356-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-9"><a href="docker-container.html#cb356-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ssm call to remove current dockerfile</span></span>
<span id="cb356-10"><a href="docker-container.html#cb356-10" aria-hidden="true" tabindex="-1"></a><span class="co"># on remote machine</span></span>
<span id="cb356-11"><a href="docker-container.html#cb356-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> /home/ec2-user/docker/Dockerfile</span>
<span id="cb356-12"><a href="docker-container.html#cb356-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-13"><a href="docker-container.html#cb356-13" aria-hidden="true" tabindex="-1"></a><span class="co"># run local scp command to copy lateste Dockerfile to EC2, local scp generated by ec2managee</span></span>
<span id="cb356-14"><a href="docker-container.html#cb356-14" aria-hidden="true" tabindex="-1"></a><span class="co"># on local machine</span></span>
<span id="cb356-15"><a href="docker-container.html#cb356-15" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> -o StrictHostKeyChecking=accept-new -i C:/Users/fan/CondaPrj/boto3aws/aws_ec2/pem/fan_wang-key-pair-us_east_nv.pem C:/Users/fan/CondaPrj/boto3aws/aws_ecr/container/DockerfileInstall ec2-user@54.161.29.209:~/docker/Dockerfile</span></code></pre></div>
<p>Second, start container service remotely, and build new container:</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb357-1"><a href="docker-container.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start docker service on ec2</span></span>
<span id="cb357-2"><a href="docker-container.html#cb357-2" aria-hidden="true" tabindex="-1"></a><span class="co"># on remote machine</span></span>
<span id="cb357-3"><a href="docker-container.html#cb357-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service docker start</span>
<span id="cb357-4"><a href="docker-container.html#cb357-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-5"><a href="docker-container.html#cb357-5" aria-hidden="true" tabindex="-1"></a><span class="co"># On remote machine</span></span>
<span id="cb357-6"><a href="docker-container.html#cb357-6" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/ec2-user/docker</span>
<span id="cb357-7"><a href="docker-container.html#cb357-7" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build -t fanconda6 --build-arg CACHE_DATE=2020-09-21-22-43-52 .</span></code></pre></div>
<p>Third, push new container to ECR (tag, get token, login, push):</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb358-1"><a href="docker-container.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start Container Service</span></span>
<span id="cb358-2"><a href="docker-container.html#cb358-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service docker start</span>
<span id="cb358-3"><a href="docker-container.html#cb358-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-4"><a href="docker-container.html#cb358-4" aria-hidden="true" tabindex="-1"></a><span class="co"># CD into folder on remote</span></span>
<span id="cb358-5"><a href="docker-container.html#cb358-5" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/ec2-user/docker</span>
<span id="cb358-6"><a href="docker-container.html#cb358-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-7"><a href="docker-container.html#cb358-7" aria-hidden="true" tabindex="-1"></a><span class="co"># tag docker</span></span>
<span id="cb358-8"><a href="docker-container.html#cb358-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> tag fancondaxxx XXXX7367XXXX.dkr.ecr.us-east-1.amazonaws.com/fancondaxxx</span>
<span id="cb358-9"><a href="docker-container.html#cb358-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-10"><a href="docker-container.html#cb358-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ECR Docker Log in</span></span>
<span id="cb358-11"><a href="docker-container.html#cb358-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ssm.get_authorization_token(registryIds=[boto3aws.aws_keys()[&#39;main_aws_id&#39;]])</span></span>
<span id="cb358-12"><a href="docker-container.html#cb358-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Decode authorization token</span></span>
<span id="cb358-13"><a href="docker-container.html#cb358-13" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> login -u AWS -p TOKENX6XXXxXXg1XXg3OX0= https://XXXX7367XXXX.dkr.ecr.us-east-1.amazonaws.com</span>
<span id="cb358-14"><a href="docker-container.html#cb358-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-15"><a href="docker-container.html#cb358-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ECR Docker Push to ECR</span></span>
<span id="cb358-16"><a href="docker-container.html#cb358-16" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push XXXX7367XXXX.dkr.ecr.us-east-1.amazonaws.com/fancondaxxx</span></code></pre></div>
</div>
<div id="pyfan-procedures" class="section level4" number="7.1.2.3">
<h4><span class="header-section-number">7.1.2.3</span> PyFan Procedures</h4>
<ol style="list-style-type: decimal">
<li>Start EC2 instance</li>
<li>Push to ECR</li>
<li>Get SSH link to EC2, SSH into EC2</li>
<li><em>sudo service docker start</em> and <em>docker images</em> (or see pull earlier)</li>
<li>start docker image and enter to access via command line: <em>docker run -t -i fanconda /bin/bash</em></li>
</ol>
</div>
<div id="more-example-ecr-code-and-outputs" class="section level4" number="7.1.2.4">
<h4><span class="header-section-number">7.1.2.4</span> More Example ECR Code and Outputs</h4>
<div id="example-docker-file-for-aws" class="section level5" number="7.1.2.4.1">
<h5><span class="header-section-number">7.1.2.4.1</span> Example Docker File for AWS</h5>
<p>Note that that private git repos are pulled in. Note also that AWS keys are set up to allow for various access to AWS services.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb359-1"><a href="docker-container.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> continuumio/anaconda3</span>
<span id="cb359-2"><a href="docker-container.html#cb359-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-3"><a href="docker-container.html#cb359-3" aria-hidden="true" tabindex="-1"></a><span class="ex">VOLUME</span> /data</span>
<span id="cb359-4"><a href="docker-container.html#cb359-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-5"><a href="docker-container.html#cb359-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Conda update</span></span>
<span id="cb359-6"><a href="docker-container.html#cb359-6" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> conda update conda</span>
<span id="cb359-7"><a href="docker-container.html#cb359-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-8"><a href="docker-container.html#cb359-8" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/ContinuumIO/docker-images/issues/49#issuecomment-311556456</span></span>
<span id="cb359-9"><a href="docker-container.html#cb359-9" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get update <span class="kw">&amp;&amp;</span> <span class="kw">\</span></span>
<span id="cb359-10"><a href="docker-container.html#cb359-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">apt-get</span> install libgl1-mesa-glx -y</span>
<span id="cb359-11"><a href="docker-container.html#cb359-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-12"><a href="docker-container.html#cb359-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Conda additional packages that i use</span></span>
<span id="cb359-13"><a href="docker-container.html#cb359-13" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> conda install -c conda-forge interpolation</span>
<span id="cb359-14"><a href="docker-container.html#cb359-14" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> conda install -c conda-forge boto3</span>
<span id="cb359-15"><a href="docker-container.html#cb359-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-16"><a href="docker-container.html#cb359-16" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://github.com/moby/moby/issues/22832, this allows for code below to run without --no-cache</span></span>
<span id="cb359-17"><a href="docker-container.html#cb359-17" aria-hidden="true" tabindex="-1"></a><span class="ex">ARG</span> CACHE_DATE=2000-01-01</span>
<span id="cb359-18"><a href="docker-container.html#cb359-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-19"><a href="docker-container.html#cb359-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Clone our private GitHub Repository: PyFan</span></span>
<span id="cb359-20"><a href="docker-container.html#cb359-20" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> git clone https://b123451234dfc025a836927PRIVATETOKEND1239@github.com/FanWangEcon/pyfan.git /pyfan/</span>
<span id="cb359-21"><a href="docker-container.html#cb359-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-22"><a href="docker-container.html#cb359-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Make port 80 available to the world outside this container</span></span>
<span id="cb359-23"><a href="docker-container.html#cb359-23" aria-hidden="true" tabindex="-1"></a><span class="ex">EXPOSE</span> 80</span>
<span id="cb359-24"><a href="docker-container.html#cb359-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-25"><a href="docker-container.html#cb359-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Install software</span></span>
<span id="cb359-26"><a href="docker-container.html#cb359-26" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> PYTHONPATH /pyfan/</span>
<span id="cb359-27"><a href="docker-container.html#cb359-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-28"><a href="docker-container.html#cb359-28" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> AWS_BUCKET_NAME=BucketName</span>
<span id="cb359-29"><a href="docker-container.html#cb359-29" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> AWS_ACCESS_KEY_ID=XKIXXXGSXXXBZXX43XXX</span>
<span id="cb359-30"><a href="docker-container.html#cb359-30" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> AWS_SECRET_ACCESS_KEY=xxTgp9r0f4XXXXXXX1XXlG1vTy07wydxXXXXXX11</span>
<span id="cb359-31"><a href="docker-container.html#cb359-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-32"><a href="docker-container.html#cb359-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Run</span></span>
<span id="cb359-33"><a href="docker-container.html#cb359-33" aria-hidden="true" tabindex="-1"></a><span class="ex">CMD</span> [<span class="st">&quot;python&quot;</span>, <span class="st">&quot;/pyfan/pyfan/graph/exa/scatterline3.py&quot;</span>]</span></code></pre></div>
</div>
<div id="example-ssm-communication" class="section level5" number="7.1.2.4.2">
<h5><span class="header-section-number">7.1.2.4.2</span> Example SSM communication</h5>
<div class="sourceCode" id="cb360"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb360-1"><a href="docker-container.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aws_keys stores keys</span></span>
<span id="cb360-2"><a href="docker-container.html#cb360-2" aria-hidden="true" tabindex="-1"></a><span class="ex">aws_keys_dict</span> = aws_keys()</span>
<span id="cb360-3"><a href="docker-container.html#cb360-3" aria-hidden="true" tabindex="-1"></a><span class="ex">ssm</span> = boto3.client(<span class="st">&#39;ssm&#39;</span>,</span>
<span id="cb360-4"><a href="docker-container.html#cb360-4" aria-hidden="true" tabindex="-1"></a>                   <span class="va">aws_access_key_id=</span>aws_keys_dict[<span class="st">&#39;aws_access_key_id&#39;</span>],</span>
<span id="cb360-5"><a href="docker-container.html#cb360-5" aria-hidden="true" tabindex="-1"></a>                   <span class="va">aws_secret_access_key=</span>aws_keys_dict[<span class="st">&#39;aws_secret_access_key&#39;</span>],</span>
<span id="cb360-6"><a href="docker-container.html#cb360-6" aria-hidden="true" tabindex="-1"></a>                   <span class="va">region_name=</span>aws_keys_dict[<span class="st">&#39;region&#39;</span>])</span>
<span id="cb360-7"><a href="docker-container.html#cb360-7" aria-hidden="true" tabindex="-1"></a><span class="ex">commands</span> = <span class="st">&#39;rm /home/ec2-user/docker/Dockerfile&#39;</span></span>
<span id="cb360-8"><a href="docker-container.html#cb360-8" aria-hidden="true" tabindex="-1"></a><span class="ex">resp</span> = client.send_command(</span>
<span id="cb360-9"><a href="docker-container.html#cb360-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">DocumentName=</span><span class="st">&quot;AWS-RunShellScript&quot;</span>, # <span class="ex">One</span> of AWS<span class="st">&#39; preconfigured documents</span></span>
<span id="cb360-10"><a href="docker-container.html#cb360-10" aria-hidden="true" tabindex="-1"></a><span class="st">        Parameters={&#39;</span>commands<span class="st">&#39;: commands},</span></span>
<span id="cb360-11"><a href="docker-container.html#cb360-11" aria-hidden="true" tabindex="-1"></a><span class="st">        InstanceIds=[instance_id])</span></span></code></pre></div>
</div>
<div id="outputs-from-docker-build" class="section level5" number="7.1.2.4.3">
<h5><span class="header-section-number">7.1.2.4.3</span> Outputs from Docker Build</h5>
<p>outputs from docker build</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb361-1"><a href="docker-container.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="ex">json.py</span> - jdump - 47 -  2020-09-22 16:04:32,459 - INFO list_command_invocation-cur_output</span>
<span id="cb361-2"><a href="docker-container.html#cb361-2" aria-hidden="true" tabindex="-1"></a>:[</span>
<span id="cb361-3"><a href="docker-container.html#cb361-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Sending build context to Docker daemon  3.072kB\r\r&quot;</span>,</span>
<span id="cb361-4"><a href="docker-container.html#cb361-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 1/16 : FROM continuumio/anaconda3&quot;</span>,</span>
<span id="cb361-5"><a href="docker-container.html#cb361-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; 472a925c4385&quot;</span>,</span>
<span id="cb361-6"><a href="docker-container.html#cb361-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 2/16 : VOLUME /data&quot;</span>,</span>
<span id="cb361-7"><a href="docker-container.html#cb361-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Using cache&quot;</span>,</span>
<span id="cb361-8"><a href="docker-container.html#cb361-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; cf4e6a503f00&quot;</span>,</span>
<span id="cb361-9"><a href="docker-container.html#cb361-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 3/16 : RUN conda update conda&quot;</span>,</span>
<span id="cb361-10"><a href="docker-container.html#cb361-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Using cache&quot;</span>,</span>
<span id="cb361-11"><a href="docker-container.html#cb361-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; 542901f01365&quot;</span>,</span>
<span id="cb361-12"><a href="docker-container.html#cb361-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 4/16 : RUN apt-get update &amp;&amp; apt-get install libgl1-mesa-glx -y&quot;</span>,</span>
<span id="cb361-13"><a href="docker-container.html#cb361-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Using cache&quot;</span>,</span>
<span id="cb361-14"><a href="docker-container.html#cb361-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; 6672960aa00c&quot;</span>,</span>
<span id="cb361-15"><a href="docker-container.html#cb361-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 5/16 : RUN conda install -c conda-forge interpolation&quot;</span>,</span>
<span id="cb361-16"><a href="docker-container.html#cb361-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Using cache&quot;</span>,</span>
<span id="cb361-17"><a href="docker-container.html#cb361-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; efd86a4259a4&quot;</span>,</span>
<span id="cb361-18"><a href="docker-container.html#cb361-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 6/16 : RUN conda install -c conda-forge boto3&quot;</span>,</span>
<span id="cb361-19"><a href="docker-container.html#cb361-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Using cache&quot;</span>,</span>
<span id="cb361-20"><a href="docker-container.html#cb361-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; bd0146dac9b3&quot;</span>,</span>
<span id="cb361-21"><a href="docker-container.html#cb361-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 7/16 : ARG CACHE_DATE=2000-01-01&quot;</span>,</span>
<span id="cb361-22"><a href="docker-container.html#cb361-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Using cache&quot;</span>,</span>
<span id="cb361-23"><a href="docker-container.html#cb361-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; dc40688e3720&quot;</span>,</span>
<span id="cb361-24"><a href="docker-container.html#cb361-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 8/16 : RUN git clone https://XXXX@github.com/FanWangEcon/pyfan.git /pyfan/&quot;</span>,</span>
<span id="cb361-25"><a href="docker-container.html#cb361-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Running in 9c0c2a444540&quot;</span>,</span>
<span id="cb361-26"><a href="docker-container.html#cb361-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;\u001b[91mCloning into &#39;/pyfan&#39;...&quot;</span>,</span>
<span id="cb361-27"><a href="docker-container.html#cb361-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;\u001b[0mRemoving intermediate container 9c0c2a444540&quot;</span>,</span>
<span id="cb361-28"><a href="docker-container.html#cb361-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; c80480cc51a1&quot;</span>,</span>
<span id="cb361-29"><a href="docker-container.html#cb361-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 9/16 : RUN git clone https://XXXX@github.com/FanWangEcon/CondaProg.git /CondaProg/&quot;</span>,</span>
<span id="cb361-30"><a href="docker-container.html#cb361-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Running in 07d9f665b760&quot;</span>,</span>
<span id="cb361-31"><a href="docker-container.html#cb361-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;\u001b[91mCloning into &#39;/CondaProg&#39;...&quot;</span>,</span>
<span id="cb361-32"><a href="docker-container.html#cb361-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;\u001b[0mRemoving intermediate container 07d9f665b760&quot;</span>,</span>
<span id="cb361-33"><a href="docker-container.html#cb361-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; a5ac6c6e1458&quot;</span>,</span>
<span id="cb361-34"><a href="docker-container.html#cb361-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 10/16 : EXPOSE 80&quot;</span>,</span>
<span id="cb361-35"><a href="docker-container.html#cb361-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Running in 1a8ef516e236&quot;</span>,</span>
<span id="cb361-36"><a href="docker-container.html#cb361-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Removing intermediate container 1a8ef516e236&quot;</span>,</span>
<span id="cb361-37"><a href="docker-container.html#cb361-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; 13ab2965e892&quot;</span>,</span>
<span id="cb361-38"><a href="docker-container.html#cb361-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 11/16 : ENV PYTHONPATH /pyfan/&quot;</span>,</span>
<span id="cb361-39"><a href="docker-container.html#cb361-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Running in 2d9e4b68164b&quot;</span>,</span>
<span id="cb361-40"><a href="docker-container.html#cb361-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Removing intermediate container 2d9e4b68164b&quot;</span>,</span>
<span id="cb361-41"><a href="docker-container.html#cb361-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; 0a74e69ce1c8&quot;</span>,</span>
<span id="cb361-42"><a href="docker-container.html#cb361-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 12/16 : ENV PYTHONPATH </span><span class="va">$PYTHONPATH</span><span class="st">:/CondaProg/&quot;</span>,</span>
<span id="cb361-43"><a href="docker-container.html#cb361-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Running in ba59f1273f51&quot;</span>,</span>
<span id="cb361-44"><a href="docker-container.html#cb361-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Removing intermediate container ba59f1273f51&quot;</span>,</span>
<span id="cb361-45"><a href="docker-container.html#cb361-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; 11fd9d732e2e&quot;</span>,</span>
<span id="cb361-46"><a href="docker-container.html#cb361-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 13/16 : ENV AWS_BUCKET_NAME=BucketName&quot;</span>,</span>
<span id="cb361-47"><a href="docker-container.html#cb361-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Running in e7a052d3eacf&quot;</span>,</span>
<span id="cb361-48"><a href="docker-container.html#cb361-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Removing intermediate container e7a052d3eacf&quot;</span>,</span>
<span id="cb361-49"><a href="docker-container.html#cb361-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; 5e294f562838&quot;</span>,</span>
<span id="cb361-50"><a href="docker-container.html#cb361-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 14/16 : ENV AWS_ACCESS_KEY_ID=XXXXX5GSDZSXXXX43XXX&quot;</span>,</span>
<span id="cb361-51"><a href="docker-container.html#cb361-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Running in 60d810a8514f&quot;</span>,</span>
<span id="cb361-52"><a href="docker-container.html#cb361-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Removing intermediate container 60d810a8514f&quot;</span>,</span>
<span id="cb361-53"><a href="docker-container.html#cb361-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; 2fa1ac4e7d3b&quot;</span>,</span>
<span id="cb361-54"><a href="docker-container.html#cb361-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 15/16 : ENV AWS_SECRET_ACCESS_KEY=XXXXXXXXXXXXX&quot;</span>,</span>
<span id="cb361-55"><a href="docker-container.html#cb361-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Running in 8b34126cee5d&quot;</span>,</span>
<span id="cb361-56"><a href="docker-container.html#cb361-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Removing intermediate container 8b34126cee5d&quot;</span>,</span>
<span id="cb361-57"><a href="docker-container.html#cb361-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; 93bd8b521d61&quot;</span>,</span>
<span id="cb361-58"><a href="docker-container.html#cb361-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Step 16/16 : CMD [</span><span class="dt">\&quot;</span><span class="st">python</span><span class="dt">\&quot;</span><span class="st">, </span><span class="dt">\&quot;</span><span class="st">/CondaPrj/invoke/invoke.py</span><span class="dt">\&quot;</span><span class="st">]&quot;</span>,</span>
<span id="cb361-59"><a href="docker-container.html#cb361-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; Running in dd3ed44dcca7&quot;</span>,</span>
<span id="cb361-60"><a href="docker-container.html#cb361-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Removing intermediate container dd3ed44dcca7&quot;</span>,</span>
<span id="cb361-61"><a href="docker-container.html#cb361-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; ---&gt; 506f92a794cd&quot;</span>,</span>
<span id="cb361-62"><a href="docker-container.html#cb361-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Successfully built 506f92a794cd&quot;</span>,</span>
<span id="cb361-63"><a href="docker-container.html#cb361-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Successfully tagged fanconda:latest&quot;</span>,</span>
<span id="cb361-64"><a href="docker-container.html#cb361-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Total reclaimed space: 0B&quot;</span>,</span>
<span id="cb361-65"><a href="docker-container.html#cb361-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;</span></span>
<span id="cb361-66"><a href="docker-container.html#cb361-66" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
</div>
<div id="output-from-docker-push" class="section level5" number="7.1.2.4.4">
<h5><span class="header-section-number">7.1.2.4.4</span> Output from Docker Push</h5>
<div class="sourceCode" id="cb362"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb362-1"><a href="docker-container.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="ex">json.py</span> - jdump - 47 -  2020-09-22 16:05:32,986 - INFO list_command_invocation-cur_output</span>
<span id="cb362-2"><a href="docker-container.html#cb362-2" aria-hidden="true" tabindex="-1"></a>:[</span>
<span id="cb362-3"><a href="docker-container.html#cb362-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;The push refers to repository [XXXX7367XXXX.dkr.ecr.us-east-1.amazonaws.com/fanconda]&quot;</span>,</span>
<span id="cb362-4"><a href="docker-container.html#cb362-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;63cc929545c3: Preparing&quot;</span>,</span>
<span id="cb362-5"><a href="docker-container.html#cb362-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;d849f5d67bbb: Preparing&quot;</span>,</span>
<span id="cb362-6"><a href="docker-container.html#cb362-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;f9c77b2e4c5f: Preparing&quot;</span>,</span>
<span id="cb362-7"><a href="docker-container.html#cb362-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;7ffd6385ae0e: Preparing&quot;</span>,</span>
<span id="cb362-8"><a href="docker-container.html#cb362-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2fc88e09d363: Preparing&quot;</span>,</span>
<span id="cb362-9"><a href="docker-container.html#cb362-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;50e089036495: Preparing&quot;</span>,</span>
<span id="cb362-10"><a href="docker-container.html#cb362-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;6637031dbcc2: Preparing&quot;</span>,</span>
<span id="cb362-11"><a href="docker-container.html#cb362-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;68d0bdfd0715: Preparing&quot;</span>,</span>
<span id="cb362-12"><a href="docker-container.html#cb362-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;d0f104dc0a1f: Preparing&quot;</span>,</span>
<span id="cb362-13"><a href="docker-container.html#cb362-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;50e089036495: Waiting&quot;</span>,</span>
<span id="cb362-14"><a href="docker-container.html#cb362-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;6637031dbcc2: Waiting&quot;</span>,</span>
<span id="cb362-15"><a href="docker-container.html#cb362-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;68d0bdfd0715: Waiting&quot;</span>,</span>
<span id="cb362-16"><a href="docker-container.html#cb362-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;d0f104dc0a1f: Waiting&quot;</span>,</span>
<span id="cb362-17"><a href="docker-container.html#cb362-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2fc88e09d363: Layer already exists&quot;</span>,</span>
<span id="cb362-18"><a href="docker-container.html#cb362-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;7ffd6385ae0e: Layer already exists&quot;</span>,</span>
<span id="cb362-19"><a href="docker-container.html#cb362-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;50e089036495: Layer already exists&quot;</span>,</span>
<span id="cb362-20"><a href="docker-container.html#cb362-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;6637031dbcc2: Layer already exists&quot;</span>,</span>
<span id="cb362-21"><a href="docker-container.html#cb362-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;68d0bdfd0715: Layer already exists&quot;</span>,</span>
<span id="cb362-22"><a href="docker-container.html#cb362-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;d0f104dc0a1f: Layer already exists&quot;</span>,</span>
<span id="cb362-23"><a href="docker-container.html#cb362-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;d849f5d67bbb: Pushed&quot;</span>,</span>
<span id="cb362-24"><a href="docker-container.html#cb362-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;f9c77b2e4c5f: Pushed&quot;</span>,</span>
<span id="cb362-25"><a href="docker-container.html#cb362-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;63cc929545c3: Pushed&quot;</span>,</span>
<span id="cb362-26"><a href="docker-container.html#cb362-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;latest: digest: sha256:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX size: 2226&quot;</span>,</span>
<span id="cb362-27"><a href="docker-container.html#cb362-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;</span></span>
<span id="cb362-28"><a href="docker-container.html#cb362-28" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
</div>
<div id="aws-ecr-instructions" class="section level5" number="7.1.2.4.5">
<h5><span class="header-section-number">7.1.2.4.5</span> AWS ECR Instructions</h5>
<p>Under repositories listed under ECR, click on <em>View push command</em>, which shows:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb363-1"><a href="docker-container.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve an authentication token and authenticate your Docker client to your registry.</span></span>
<span id="cb363-2"><a href="docker-container.html#cb363-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the AWS CLI:</span></span>
<span id="cb363-3"><a href="docker-container.html#cb363-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-4"><a href="docker-container.html#cb363-4" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ecr get-login-password --region us-east-1 <span class="kw">|</span> <span class="ex">docker</span> login --username AWS --password-stdin XXXX7367XXXX.dkr.ecr.us-east-1.amazonaws.com</span>
<span id="cb363-5"><a href="docker-container.html#cb363-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-6"><a href="docker-container.html#cb363-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: If you receive an error using the AWS CLI, make sure that you have the latest version of the AWS CLI and Docker installed.</span></span>
<span id="cb363-7"><a href="docker-container.html#cb363-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Build your Docker image using the following command. For information on building a Docker file from scratch see the instructions here . You can skip this step if your image is already built:</span></span>
<span id="cb363-8"><a href="docker-container.html#cb363-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build -t fanconda .</span>
<span id="cb363-9"><a href="docker-container.html#cb363-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-10"><a href="docker-container.html#cb363-10" aria-hidden="true" tabindex="-1"></a><span class="co"># After the build completes, tag your image so you can push the image to this repository:</span></span>
<span id="cb363-11"><a href="docker-container.html#cb363-11" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> tag fanconda:latest XXXX7367XXXX.dkr.ecr.us-east-1.amazonaws.com/fanconda:latest</span></code></pre></div>
</div>
</div>
<div id="command-line-sequence-gathered" class="section level4" number="7.1.2.5">
<h4><span class="header-section-number">7.1.2.5</span> Command Line Sequence Gathered</h4>
<p>Gathered sequence of command line operations:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb364-1"><a href="docker-container.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> -i <span class="st">&quot;G:/repos/CondaPrj/boto3aws/aws_ec2/pem/fan_wang-key-pair-us_east_nv.pem&quot;</span> ec2-user@34.229.39.138</span>
<span id="cb364-2"><a href="docker-container.html#cb364-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-3"><a href="docker-container.html#cb364-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run -t -i fanconda /bin/bash</span>
<span id="cb364-4"><a href="docker-container.html#cb364-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-5"><a href="docker-container.html#cb364-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> -o StrictHostKeyChecking=accept-new -i G:/repos/CondaPrj/boto3aws/aws_ec2/pem/fan_wang-key-pair-us_east_nv.pem G:/repos/CondaPrj/boto3aws/aws_ecr/container/DockerfileConda ec2-user@34.229.39.138:~/docker/Dockerfile</span>
<span id="cb364-6"><a href="docker-container.html#cb364-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-7"><a href="docker-container.html#cb364-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service docker start</span>
<span id="cb364-8"><a href="docker-container.html#cb364-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-9"><a href="docker-container.html#cb364-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/ec2-user/docker</span>
<span id="cb364-10"><a href="docker-container.html#cb364-10" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build -t fanconda --build-arg CACHE_DATE=2020-12-22-10-58-57 .</span>
<span id="cb364-11"><a href="docker-container.html#cb364-11" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> system prune --force</span>
<span id="cb364-12"><a href="docker-container.html#cb364-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-13"><a href="docker-container.html#cb364-13" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/ec2-user/docker</span>
<span id="cb364-14"><a href="docker-container.html#cb364-14" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> tag fanconda 710673677961.dkr.ecr.us-east-1.amazonaws.com/fanconda</span>
<span id="cb364-15"><a href="docker-container.html#cb364-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-16"><a href="docker-container.html#cb364-16" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ecr get-login --no-include-email</span>
<span id="cb364-17"><a href="docker-container.html#cb364-17" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> login -u AWS -p XXXXX= https://710673677961.dkr.ecr.us-east-1.amazonaws.com</span>
<span id="cb364-18"><a href="docker-container.html#cb364-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-19"><a href="docker-container.html#cb364-19" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push 710673677961.dkr.ecr.us-east-1.amazonaws.com/fanconda</span></code></pre></div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="amazon-web-services.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="get-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Data-Structures-and-Cloud-Services-with-Python.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
